app.get('/user/Report',
 async function (req, res) {
    var myDb = "facility";
    var myCollection;
    var report_Type = "facility";
    if (report_Type == "facility"){
        myCollection = "reportedFacility";
        var reportedFacilityID = 88888;
        var reportedFacilityType = "entertainment";
        var reporterID = "jiajungao0124@gmail.com";
        var reportReason = "idk caonima";
        var facilityObj = { 
            report_Type: report_Type,
            facility_id: reportedFacilityID,
            facility_type: reportedFacilityType,
            reporter_id: reporterID,
            reason: reportReason
            }; 

        var findedReportFacility;
        var finalStatusResult;
        //sending request to admin and wait for approbal or denial
        await client.db(myDb).collection(myCollection).insertOne(facilityObj, function(err, res) {
            var finalResult = JSON.stringify(res);
            if (err) throw err;
            console.log(finalResult);
            var url = 'http://20.213.243.141:8000/admin/ApprovalofFacility';
            request(url, function(err, response, body) {
            if (err != null) {
                var s = util.format("Error: %s", err);
                console.log(s);
                res.send(s);
                return;
            }
            finalStatusResult = JSON.stringify(body);
            console.log("the status for the request is : " + finalStatusResult);     
            });     
          });
        //if approved find the facility and add field to it
        await client.db(myDb).collection("facility").find({facility_id: reportedFacilityID, facility_type:reportedFacilityType}).toArray(function(err, result) {
            findedReportFacility = JSON.stringify(result);
            if (err) throw err;
            console.log("the facility being reported is:" + findedReportFacility);
          
           
           var facilityFinalQuey = { facility_id: reportedFacilityID,
                                     facility_type: reportedFacilityID};
           var finalFacilityStatus = {$set: {facility_status: finalStatusResult} }; //need to confirm how exactly should status look like
           client.db(myDb).collection("facility").updateOne(facilityFinalQuey, finalFacilityStatus, function(err, res) {
             if (err) throw err;
             console.log(res);
             
           });  
           res.send(findedReportFacility);    
          });

        
        //  var facilityFinalQuey = { facility_id: delteFacilityID,
        //                            facility_type: deleteFacilityType,
        //                            facility_status: {temp_id:345, approve:2}};
        // var finalFacilityStatus = {$set: {facility_status: finalStatusResult}}; 
        // await client.db(myDb).collection("facility").updateOne(facilityFinalQuey, {$set: {facility_status: finalStatusResult}}, function(err, res) {
        //     if (err) throw err;
        //     console.log("now facility has new fields: " + JSON.stringify(finalFacilityStatus));
        //     // res.send(findedReportFacility);     
        //   });        
    }  
 }
)

app.get('/admin/ApprovalofFacility',
 async function (req, res) {
    var responseJson = {
        temp_id: 1,
        approve: 1
    }
    var finalResult = JSON.stringify(responseJson);
     if(responseJson.approve == 0){
         res.send ("report is unsuccessful");
         console.log("report not succeeeded");
     }
     else{
         res.send(finalResult); //would it be better to just get name of faility?
         console.log("admin decision status for reported facility is:  " + finalResult);
     }      
     
 }
)

